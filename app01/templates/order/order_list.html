{% extends "layout.html" %}

{% block content %}
<br>
<div class="container">
    <h3>订单列表</h3>
    <a href="/order/add" class="btn btn-primary mb-3">添加订单</a>
    <table class="table table-bordered table-hover">
        <thead class="table-dark">
            <tr>
                <th>订单号</th>
                <th>标题</th>
                <th>价格</th>
                <th>状态</th>
                <th>用户</th>
                <th>排片</th>
                <th>座位</th>
                <th>购买时间</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
            {% for order in queryset %}
            <tr>
                <td>{{ order.oid }}</td>
                <td>{{ order.title }}</td>
                <td>{{ order.price }}</td>
                <td>
                    {% if order.status == 1 %}
                        待支付
                    {% elif order.status == 2 %}
                        支付中
                    {% elif order.status == 3 %}
                        已支付
                    {% else %}
                        未知
                    {% endif %}
                </td>
                <td>{{ order.user.name }} ({{ order.user.user_id }})</td>
                <td>
                    {% if order.schedule %}
                        {{ order.schedule.movie.title }} - {{ order.schedule.hall.name }} - {{ order.schedule.show_time|date:"Y-m-d H:i" }}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>
                    {% if order.seat %}
                        {{ order.seat.seat_number }}（{{ order.seat.get_status_display }}）
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>{{ order.buy_time|date:"Y-m-d H:i:s" }}</td>
                <td>
                    <a href="/order/edit/{{ order.oid }}" class="btn btn-sm btn-warning">编辑</a>
                    <a href="/order/delete?oid={{ order.oid }}" class="btn btn-sm btn-danger"
                       onclick="return confirm('确认删除订单 {{ order.oid }} ?');">删除</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="9" class="text-center">暂无订单数据</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
